(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"./bundles/querybuilder.js":function(e,t,l){"use strict";l.r(t);var n=l("../node_modules/@babel/runtime/helpers/typeof.js"),r=l.n(n);window.sf=window.sf||{},window.sf.querybuilder=function(e,t,l,n,o,i,a,s,u){var p,d=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(e,t)},function(e,t){function l(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(l.prototype=t.prototype,new l)}),c=function(e,t,l,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,l):n;if("object"==("undefined"==typeof Reflect?"undefined":r()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,l,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,l,a):o(t,l))||a);return i>3&&a&&Object.defineProperty(t,l,a),a};n.MultiSelect.Inject(n.CheckBoxSelection);var h=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return d(l,e),c([t.Property(null)],l.prototype,"field",void 0),c([t.Property(null)],l.prototype,"label",void 0),c([t.Property(null)],l.prototype,"type",void 0),c([t.Property(null)],l.prototype,"values",void 0),c([t.Property(null)],l.prototype,"operators",void 0),c([t.Property(null)],l.prototype,"template",void 0),c([t.Property({isRequired:!0,min:0,max:Number.MAX_VALUE})],l.prototype,"validation",void 0),c([t.Property(null)],l.prototype,"format",void 0),c([t.Property(null)],l.prototype,"step",void 0),c([t.Property(null)],l.prototype,"value",void 0),c([t.Property(null)],l.prototype,"category",void 0),l}(t.ChildProperty),m=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return d(l,e),c([t.Property(null)],l.prototype,"condition",void 0),c([t.Collection([],l)],l.prototype,"rules",void 0),c([t.Property(null)],l.prototype,"field",void 0),c([t.Property(null)],l.prototype,"label",void 0),c([t.Property(null)],l.prototype,"type",void 0),c([t.Property(null)],l.prototype,"operator",void 0),c([t.Property(null)],l.prototype,"value",void 0),c([t.Property(!1)],l.prototype,"not",void 0),l}(t.ChildProperty),f=function(e){function l(){return null!==e&&e.apply(this,arguments)||this}return d(l,e),c([t.Property(!0)],l.prototype,"ruleDelete",void 0),c([t.Property(!0)],l.prototype,"groupInsert",void 0),c([t.Property(!0)],l.prototype,"groupDelete",void 0),l}(t.ChildProperty),g=function(e){function p(t,l){return e.call(this,t,l)||this}return d(p,e),p.prototype.getPersistData=function(){return this.addOnPersist(["rule"])},p.prototype.reset=function(){this.isImportRules=!1;var e=this.element.querySelector(".e-group-body");e.innerHTML="",this.enableNotCondition&&t.removeClass(this.element.querySelectorAll(".e-qb-toggle"),"e-active-toggle"),e.appendChild(this.createElement("div",{attrs:{class:"e-rule-list"}})),this.levelColl[this.element.id+"_group0"]=[0],this.rule={condition:"and",not:!1,rules:[]},this.disableRuleCondition(e.parentElement)},p.prototype.getWrapper=function(){return this.element},p.prototype.getModuleName=function(){return"query-builder"},p.prototype.initialize=function(){if(this.dataColl.length){var e=Object.keys(this.dataColl[0]),t=[],l=void 0,n=!1,o=!1,i=void 0,a={isRequired:!0,min:0,max:Number.MAX_VALUE};if(this.columns.length){this.columnSort();for(var s=0,u=(p=this.columns).length;s<u;s++)p[s].type||(e.indexOf(p[s].field)>-1&&("string"===(l=r()(i=this.dataColl[0][p[s].field]))?o=!isNaN(Date.parse(i)):"object"===l&&(o=i instanceof Date&&!isNaN(i.getTime()),l="string"),p[s].type=l,o=!1),l="string"),p[s].validation||(p[s].validation=a),p[s].category?n=!0:p[s].category=this.l10n.getConstant("OtherFields");n&&(this.fields={text:"label",value:"field",groupBy:"category"})}else{for(s=0,u=e.length;s<u;s++)"string"===(l=r()(i=this.dataColl[0][e[s]]))?o=!isNaN(Date.parse(i)):"object"===l&&(o=i instanceof Date&&!isNaN(i.getTime()),l="string"),t[s]={field:e[s],label:e[s],type:o?"date":l,validation:a},o=!1;this.columns=t}}else if(this.columns.length){var p=this.columns;for(s=0,u=p.length;s<u;s++)p[s].category?this.fields={text:"label",value:"field",groupBy:"category"}:p[s].category=this.l10n.getConstant("OtherFields")}},p.prototype.clickEventHandler=function(e){var l,n,r=this,o=e.target;if(this.isImportRules=!1,"SPAN"===o.tagName&&(o=o.parentElement),o.className.indexOf("e-collapse-rule")>-1){var i=new t.Animation({duration:1e3,delay:0});this.element.querySelectorAll(".e-summary-content").length<1&&this.renderSummary();var a=document.getElementById(this.element.id+"_summary_content"),s=a.querySelector(".e-summary-text");i.animate(".e-query-builder",{name:"SlideLeftIn"}),(p=this.element.querySelector(".e-group-container")).style.display="none",s.textContent=this.getSqlFromRules(this.rule),a.style.display="block",s.style.height=s.scrollHeight+"px"}if("BUTTON"===o.tagName&&o.className.indexOf("e-qb-toggle")<0){if(o.className.indexOf("e-removerule")>-1)this.actionButton=o,this.deleteRule(o);else if(o.className.indexOf("e-deletegroup")>-1)this.actionButton=o,this.deleteGroup(t.closest(o,".e-group-container"));else if(o.className.indexOf("e-edit-rule")>-1)if((i=new t.Animation({duration:1e3,delay:0})).animate(".e-query-builder",{name:"SlideLeftIn"}),document.getElementById(this.element.id+"_summary_content").style.display="none",this.element.querySelectorAll(".e-group-container").length<1){this.addGroupElement(!1,this.element,this.rule.condition);var u=t.extend({},this.rule,{},!0);this.setGroupRules(u),this.renderSummaryCollapse()}else{var p=this.element.querySelector(".e-group-container");p.querySelectorAll(".e-collapse-rule").length<1&&this.renderSummaryCollapse(),p.style.display="block"}}else if("LABEL"===o.tagName&&o.parentElement.className.indexOf("e-btn-group")>-1||o.className.indexOf("e-qb-toggle")>-1){var d=t.closest(o,".e-group-container"),c=o.getAttribute("for"),h=void 0;c&&(h=document.getElementById(c).getAttribute("value")),n=d.id.replace(this.element.id+"_","");var m=void 0;if(this.enableNotCondition)if(o.className.indexOf("e-qb-toggle")>-1){var f=d.getElementsByClassName("e-qb-toggle")[0];f.className.indexOf("e-active-toggle")>-1?(t.removeClass([f],"e-active-toggle"),m=!1):(t.addClass([f],"e-active-toggle"),m=!0),h=this.rule.condition}else m=this.rule.not;l={groupID:n,cancel:!1,type:"condition",value:h.toLowerCase()},this.enableNotCondition&&(l={groupID:n,cancel:!1,type:"condition",value:h.toLowerCase(),not:m}),this.isImportRules?this.beforeSuccessCallBack(l,o):this.trigger("beforeChange",l,(function(e){r.beforeSuccessCallBack(e,o)}))}},p.prototype.beforeSuccessCallBack=function(e,l){if(!e.cancel){var n=t.closest(l,".e-group-container"),r=n.id.replace(this.element.id+"_",""),o=this.getValidRules(this.rule),i=this.getParentGroup(n);i.condition=e.value,this.enableNotCondition&&(i.not=e.not),this.isImportRules||this.trigger("change",{groupID:r,type:"condition",value:i.condition}),this.filterRules(o,this.getValidRules(this.rule),"condition")}},p.prototype.selectBtn=function(e,l){"beforeOpen"===l.name?this.showButtons.groupInsert?t.removeClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):t.addClass([l.element.querySelector("li span.e-addgroup").parentElement],"e-button-hide"):l.element.children[0].className.indexOf("e-addrule")>-1?this.addRuleElement(t.closest(e,".e-group-container"),{}):l.element.children[0].className.indexOf("e-addgroup")>-1&&this.addGroupElement(!0,t.closest(e,".e-group-container"),"",!0)},p.prototype.addRuleElement=function(e,t){var l=this;if(e){var n={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"insertRule"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addRuleSuccessCallBack(n,e,t)):this.trigger("beforeChange",n,(function(n){l.addRuleSuccessCallBack(n,e,t)}))}},p.prototype.addRuleSuccessCallBack=function(e,l,r){if(!e.cancel){var o=this.ruleElem.cloneNode(!0);"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?o.className="e-rule-container e-vertical-mode":o.className="e-rule-container e-horizontal-mode";var i,a,s,p=void 0,d=void 0,c=void 0,h=void 0,m=l.querySelector(".e-rule-list"),f=o.querySelector("button");if(this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?(f.textContent=this.l10n.getConstant("Remove"),t.addClass([f],"e-flat"),t.addClass([f],"e-primary")):(t.addClass([f],"e-round"),t.addClass([f],"e-icon-btn"),new u.Tooltip({content:this.l10n.getConstant("DeleteRule")}).appendTo(f),f=this.createElement("span",{attrs:{class:"e-btn-icon e-icons e-delete-icon"}}),o.querySelector("button").appendChild(f)),o.setAttribute("id",l.id+"_rule"+this.ruleIdCounter),this.ruleIdCounter++,o.querySelector(".e-filter-input").setAttribute("id",o.id+"_filterkey"),m.appendChild(o),o.previousElementSibling&&o.previousElementSibling.className.indexOf("e-rule-container")>-1&&(o.className.indexOf("e-joined-rule")<0&&(o.className+=" e-joined-rule"),o.previousElementSibling.className.indexOf("e-prev-joined-rule")<0&&(o.previousElementSibling.className+=" e-prev-joined-rule")),o.previousElementSibling&&o.previousElementSibling.className.indexOf("e-group-container")>-1&&o.className.indexOf("e-separate-rule")<0&&(o.className+=" e-separate-rule"),a=this.element.className.indexOf("e-device")>-1?"250px":"200px",(h=new n.DropDownList({dataSource:this.columns,fields:this.fields,placeholder:this.l10n.getConstant("SelectField"),popupHeight:this.columns.length>5?a:"auto",change:this.changeField.bind(this),value:r?r.field:null})).appendTo("#"+o.id+"_filterkey"),i=this.levelColl[l.id],this.selectedColumn=h.getDataByValue(h.value),!this.isImportRules){for(p=this.rule,d=0,c=i.length;d<c;d++)p=this.findGroupByIdx(i[d],p,0===d);Object.keys(r).length?p.rules.push({field:r.field,type:r.type,label:r.label,operator:r.operator,value:r.value}):p.rules.push({field:"",type:"",label:"",operator:"",value:""})}this.isImportRules||this.disableRuleCondition(l,p),Object.keys(r).length&&this.changeRule(r,{element:h.element,itemData:this.selectedColumn}),s=o.id.replace(this.element.id+"_",""),this.isImportRules||this.trigger("change",{groupID:l.id.replace(this.element.id+"_",""),ruleID:s,type:"insertRule"})}},p.prototype.renderToolTip=function(e){var t=new u.Tooltip({content:this.l10n.getConstant("ValidationMessage"),position:"BottomCenter",cssClass:"e-querybuilder-error"});t.appendTo(e),t.open(e)},p.prototype.validateFields=function(){var e=!0;if(this.allowValidation){var l,n=void 0,r=void 0,o=void 0,i=[],a=void 0,s=void 0,u=void 0,p=void 0,d=void 0,c=this.element.querySelectorAll(".e-rule-container"),h=void 0;for(n=0,l=c.length;n<l;n++)if(a=t.closest(c[n],".e-group-container"),d=this.getParentGroup(a),s=0,o=p=c[n],u=t.getComponent(c[n].querySelector(".e-rule-field input.e-control"),"dropdownlist"),this.selectedColumn=u.getDataByValue(u.value),h=!t.isNullOrUndefined(u.index)&&this.selectedColumn.validation,r=p.querySelector(".e-rule-field input.e-control"),h&&h.isRequired){for(;o&&null!==o.previousElementSibling;)o=o.previousElementSibling,s++;if(r=p.querySelector(".e-rule-field input.e-control"),d.rules[s].field||(r.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(r.parentElement),e=!1),r=p.querySelector(".e-rule-operator input.e-control"),d.rules[s].operator||(r.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(r.parentElement),e=!1),d.rules[s].value instanceof Array&&(i=d.rules[s].value),t.isNullOrUndefined(d.rules[s].value)||""===d.rules[s].value||d.rules[s].value instanceof Array&&i.length<1){var m=p.querySelectorAll(".e-rule-value input.e-control");e=!1;for(var f=0,g=m.length;f<g;f++){var y=m[f],v=void 0;y.parentElement.className.indexOf("e-searcher")>-1?(v=t.closest(y,".e-multi-select-wrapper")).className.indexOf("e-tooltip")<0&&this.renderToolTip(v):m[f].parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(m[f].parentElement),f++}}}else u.element&&t.isNullOrUndefined(u.index)&&(r.parentElement.className.indexOf("e-tooltip")<0&&this.renderToolTip(r.parentElement),e=!1)}return e},p.prototype.refreshLevelColl=function(){this.levelColl={};var e=this.element.querySelector(".e-group-container");this.levelColl[e.id]=[0];var t={groupElement:e,level:[0]};this.refreshLevel(t)},p.prototype.refreshLevel=function(e){var l,n,r=e.groupElement.querySelector(".e-rule-list").children,o=e.groupElement,i=r.length,a=0;for(n=0;n<i;n++)(l=r[n]).className.indexOf("e-group-container")>-1&&(e.level.push(a),this.levelColl[l.id]=e.level.slice(),a++,e.groupElement=l,e=this.refreshLevel(e));var s=t.closest(o,".e-rule-list");return e.groupElement=s?t.closest(s,".e-group-container"):o,e.level=this.levelColl[e.groupElement.id].slice(),e},p.prototype.groupTemplate=function(){var e,t,l,n,r,o,i,a,s;return e=this.createElement("div",{attrs:{class:"e-group-container"}}),l=this.createElement("div",{attrs:{class:"e-group-header"}}),t=this.createElement("div",{attrs:{class:"e-group-body"}}),n=this.createElement("div",{attrs:{class:"e-rule-list"}}),e.appendChild(l),t.appendChild(n),e.appendChild(t),r=this.createElement("div",{attrs:{class:"e-btn-group"}}),this.enableNotCondition&&(o=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}}),r.appendChild(o)),(o=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-and",value:"AND"}})).setAttribute("checked","true"),r.appendChild(o),i=this.createElement("label",{attrs:{class:"e-btn e-btngroup-and-lbl e-small"},innerHTML:this.l10n.getConstant("AND")}),r.appendChild(i),o=this.createElement("input",{attrs:{type:"radio",class:"e-btngroup-or",value:"OR"}}),r.appendChild(o),i=this.createElement("label",{attrs:{class:"e-btn e-btngroup-or-lbl e-small"},innerHTML:this.l10n.getConstant("OR")}),r.appendChild(i),l.appendChild(r),a=this.createElement("div",{attrs:{class:"e-group-action"}}),s=this.createElement("button",{attrs:{type:"button",class:"e-add-btn"}}),a.appendChild(s),l.appendChild(a),e},p.prototype.ruleTemplate=function(){var e,t,l,n,r,o;return e=this.createElement("div"),r=this.createElement("div",{attrs:{class:"e-rule-field"}}),l=this.createElement("div",{attrs:{class:"e-rule-filter"}}),t=this.createElement("input",{attrs:{type:"text",class:"e-filter-input"}}),l.appendChild(t),r.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-operator"}}),r.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value"}}),r.appendChild(l),l=this.createElement("div",{attrs:{class:"e-rule-value-delete"}}),o=this.showButtons.ruleDelete?"e-removerule e-rule-delete e-css e-btn e-small":"e-removerule e-rule-delete e-css e-btn e-small e-button-hide",n=this.createElement("button",{attrs:{class:o}}),l.appendChild(n),r.appendChild(l),e.appendChild(r),e},p.prototype.addGroupElement=function(e,t,l,n){var r=this,o={groupID:t.id.replace(this.element.id+"_",""),cancel:!1,type:"insertGroup"};this.isImportRules||this.isInitialLoad?(this.isInitialLoad=!1,this.addGroupSuccess(o,e,t,l,n)):this.trigger("beforeChange",o,(function(o){r.addGroupSuccess(o,e,t,l,n)}))},p.prototype.addGroupSuccess=function(e,n,r,o,i){if(!e.cancel&&this.element.querySelectorAll(".e-group-container").length<=this.maxGroupCount){var a=r,p=void 0,d=this.groupElem.cloneNode(!0);d.setAttribute("id",this.element.id+"_group"+this.groupIdCounter),this.groupIdCounter++;var c=d.querySelector(".e-btngroup-and"),h=d.querySelector(".e-btngroup-or"),m=d.querySelector(".e-btngroup-and-lbl"),f=d.querySelector(".e-btngroup-or-lbl"),g=d.querySelector(".e-qb-toggle");if(c.setAttribute("id",this.element.id+"_and"+this.btnGroupId),h.setAttribute("id",this.element.id+"_or"+this.btnGroupId),c.setAttribute("name",this.element.id+"_and"+this.btnGroupId),h.setAttribute("name",this.element.id+"_and"+this.btnGroupId),m.setAttribute("for",this.element.id+"_and"+this.btnGroupId),f.setAttribute("for",this.element.id+"_or"+this.btnGroupId),this.btnGroupId++,n){var y=this.showButtons.groupDelete?"e-deletegroup":"e-deletegroup e-button-hide";p=this.createElement("button",{attrs:{class:y}}),new l.Button({iconCss:"e-icons e-delete-icon",cssClass:"e-small e-round"}).appendTo(p),new u.Tooltip({content:this.l10n.getConstant("DeleteGroup")}).appendTo(p),t.rippleEffect(p,{selector:".deletegroup"}),d.querySelector(".e-group-action").appendChild(p);for(var v=a.querySelector(".e-rule-list"),b=v.children,C=0,S=0,x=b.length;S<x;S++)b[S].className.indexOf("e-group-container")>-1&&(C+=1);v.appendChild(d);var w=this.levelColl[a.id].slice(0);w.push(C),this.levelColl[d.id]=w,this.isImportRules||(this.addGroups([],a.id.replace(this.element.id+"_","")),i&&this.addRuleElement(d,{}))}else a.appendChild(d),this.levelColl[d.id]=[0];this.enableNotCondition&&(new l.Button({content:this.l10n.getConstant("NOT"),cssClass:"e-btn e-small"}).appendTo(g),d.querySelector(".e-btngroup-and-lbl").classList.add("e-not"));var E=d.querySelector(".e-add-btn");new s.DropDownButton({items:this.items,cssClass:"e-round e-small e-caret-hide e-addrulegroup",iconCss:"e-icons e-add-icon",beforeOpen:this.selectBtn.bind(this,E),select:this.selectBtn.bind(this,E)}).appendTo(E),this.isImportRules||this.trigger("change",{groupID:a.id.replace(this.element.id+"_",""),type:"insertGroup"})}},p.prototype.notifyChange=function(e,l){var n,r=t.closest(l,".e-rule-value").querySelectorAll(".e-template"),o=t.closest(l,".e-rule-container").querySelector(".e-filter-input"),i=t.getComponent(o,"dropdownlist"),a=i.getDataByValue(i.value);n=this.getFormat(a.format);for(var s=[],u=0,p=r.length;u<p;u++)"date"===a.type&&e[u]instanceof Date?s.push(this.intl.formatDate(e[u],n)):s=e;if("date"===a.type)if(e instanceof Date)e=this.intl.formatDate(e,n);else if(e instanceof Array)for(u=0;u<e.length;u++)e[u]instanceof Date&&(e[u]=this.intl.formatDate(e[u],n));this.updateRules(l,r.length>1?s:e)},p.prototype.changeValue=function(e,l){var n,r,o,i=this;((o=l.event?l.event.target:l.element).className.indexOf("e-day")>-1||o.className.indexOf("e-cell")>-1)&&(o=l.element);var a=t.closest(o,".e-group-container"),s=t.closest(o,".e-rule-container");n=a&&a.id.replace(this.element.id+"_",""),r=s.id.replace(this.element.id+"_","");var u,p,d,c=l;c.element&&c.element.className.indexOf("e-datepicker")>-1&&(o=c.element),o.className.indexOf("e-radio")>-1?(p=parseInt(o.id.split("valuekey")[1],0),d=t.getComponent(t.closest(o,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist"),this.selectedColumn=d.getDataByValue(d.value),u=this.selectedColumn.values?this.selectedColumn.values[p]:["True","False"][p]):u=o.className.indexOf("e-multiselect")>-1?t.getComponent(o,"multiselect").value:l.value,"input"===l.name&&this.immediateModeDelay?(window.clearInterval(this.timer),this.timer=window.setInterval((function(){i.filterValue(n,r,u,e,o)}),this.immediateModeDelay)):this.filterValue(n,r,u,e,o)},p.prototype.filterValue=function(e,t,l,n,r){var o=this,i={groupID:e,ruleID:t,value:l,cancel:!1,type:"value"};window.clearInterval(this.timer),this.isImportRules?this.changeValueSuccessCallBack(i,r,n,e,t):this.trigger("beforeChange",i,(function(l){o.changeValueSuccessCallBack(l,r,n,e,t)}))},p.prototype.changeValueSuccessCallBack=function(e,t,l,n,r){e.cancel||(this.updateRules(t,e.value,l),this.isImportRules||this.trigger("change",{groupID:n,ruleID:r,value:e.value,cancel:!1,type:"value"}))},p.prototype.changeField=function(e){if(e.isInteracted){for(var l=t.closest(e.element,".e-group-container"),n=this.getParentGroup(l),r=t.closest(e.element,".e-rule-container"),o=0;r&&null!==r.previousElementSibling;)r=r.previousElementSibling,o++;this.changeRule(n.rules[o],e)}},p.prototype.changeRule=function(e,l){if(l.itemData){var n=t.closest(l.element,".e-rule-filter"),r=t.getComponent(l.element,"dropdownlist"),o=t.closest(l.element,".e-group-container").id.replace(this.element.id+"_","");this.changeFilter(n,r,o,e,{},l)}},p.prototype.changeFilter=function(e,l,n,r,o,i){var a=this;if(e){this.selectedColumn=l.getDataByValue(l.value);var s;s={groupID:n,ruleID:t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),selectedField:l.value,cancel:!1,type:"field"},this.isImportRules?this.fieldChangeSuccess(s,o,e,r,i):this.trigger("beforeChange",s,(function(t){a.fieldChangeSuccess(t,o,e,r,i)}))}else{var u=t.closest(i.element,".e-rule-operator");this.changeOperator(e,u,l,n,r,o,i)}},p.prototype.changeOperator=function(e,l,n,r,o,i,a){var s,u=this;l?(s={groupID:r,ruleID:t.closest(l,".e-rule-container").id.replace(this.element.id+"_",""),selectedIndex:n.index,cancel:!1,type:"operator"},this.isImportRules?this.operatorChangeSuccess(s,e,i,o,a):this.trigger("beforeChange",s,(function(t){u.operatorChangeSuccess(t,e,i,o,a)}))):this.changeRuleValues(e,o,i,a)},p.prototype.fieldChangeSuccess=function(e,l,n,r,o){for(var i=t.closest(n,".e-rule-container"),a=t.closest(o.element,".e-rule-operator"),s=t.closest(o.element,".e-group-container").id.replace(this.element.id+"_",""),u=t.getComponent(o.element,"dropdownlist"),p=i.querySelectorAll(".e-tooltip.e-input-group"),d=0;d<p.length;d++)t.getComponent(p[d],"tooltip").destroy();e.cancel||(l.type=this.selectedColumn.type,i.querySelector(".e-template")&&(r.value="")),this.changeOperator(n,a,u,s,r,l,o)},p.prototype.operatorChangeSuccess=function(e,l,n,o,i){if(!e.cancel){var a=t.closest(i.element,".e-rule-operator"),s=a.nextElementSibling,u=t.getComponent(i.element,"dropdownlist"),p=o.operator?o.operator.toLowerCase():"";n.operator=u.value;var d=n.operator.toLowerCase();if(n.operator.toLowerCase().indexOf("between")>-1||n.operator.toLowerCase().indexOf("in")>-1&&n.operator.toLowerCase().indexOf("contains")<0?(l=a.previousElementSibling,n.type=o.type,(n.operator.toLowerCase().indexOf("in")<0||o.operator.toLowerCase().indexOf("in")<0)&&(o.value=[])):"object"==r()(o.value)&&null!=o.value&&(o.value=o.value.length>0?o.value[0]:""),i.previousItemData){var c=i.previousItemData.value.toLowerCase();(c.indexOf("between")>-1||c.indexOf("in")>-1||c.indexOf("null")>-1||c.indexOf("empty")>-1&&c.indexOf("contains")<0)&&(l=a.previousElementSibling,n.type=o.type)}if(p.indexOf("in")>-1&&p.indexOf("in")<5&&d.indexOf("in")>-1&&d.indexOf("in")<5&&(l=null),n.operator.indexOf("null")>-1||n.operator.indexOf("empty")>-1){var h=a.parentElement.querySelector(".e-rule-value");t.removeClass([h],"e-show"),t.addClass([h],"e-hide")}s&&s.querySelector(".e-template")&&(l=a.previousElementSibling),this.changeRuleValues(l,o,n,i)}},p.prototype.changeRuleValues=function(e,l,r,o){var i,a,s,u=t.closest(o.element,".e-rule-operator");if(e)if(u=e.nextElementSibling,t.addClass([u],"e-operator"),u.childElementCount){i=t.getComponent(u.querySelector(".e-dropdownlist"),"dropdownlist"),r.operator=i.value;var p=o.itemData;this.renderValues(u,p,o.previousItemData,!0,l,r,o.element)}else{var d=t.closest(u,".e-rule-container").id;s=this.createElement("input",{attrs:{type:"text",id:d+"_operatorkey"}}),u.appendChild(s),this.selectedColumn.operators?a=this.selectedColumn.operators:o.itemData&&(a=this.customOperators[this.selectedColumn.type+"Operator"]);var c=this.element.className.indexOf("e-device")>-1?"250px":"200px";new n.DropDownList({dataSource:a,fields:{text:"key",value:"value"},placeholder:this.l10n.getConstant("SelectOperator"),popupHeight:a.length>5?c:"auto",change:this.changeField.bind(this),index:0,value:l?l.operator:null}).appendTo("#"+d+"_operatorkey"),r.operator=l&&""!==l.operator?l.operator:a[0].value,this.isImportRules&&(r.type=this.selectedColumn.type,r.operator=l.operator),this.renderValues(u,this.selectedColumn,o.previousItemData,!1,l,r,o.element)}this.isImportRules||this.updateRules(o.element,o.item)},p.prototype.destroyControls=function(e){var l,n;l=e.nextElementSibling.querySelectorAll("input.e-control"),n=e.nextElementSibling.querySelectorAll("div.e-control:not(.e-handle)");for(var r=this.columns,o=0,i=l.length;o<i;o++){if(l[o].classList.contains("e-textbox"))t.getComponent(l[o],"textbox").destroy(),t.detach(e.nextElementSibling.querySelector("input#"+l[o].id));else if(l[o].classList.contains("e-dropdownlist"))t.getComponent(l[o],"dropdownlist").destroy();else if(l[o].classList.contains("e-radio"))t.getComponent(l[o],"radio").destroy();else if(l[o].classList.contains("e-numerictextbox"))t.getComponent(l[o],"numerictextbox").destroy(),t.detach(e.nextElementSibling.querySelector("input#"+l[o].id));else if(l[o].classList.contains("e-datepicker"))t.getComponent(l[o],"datepicker").destroy();else if(l[o].classList.contains("e-multiselect"))t.getComponent(l[o],"multiselect").destroy();else if(l[o].className.indexOf("e-template")>-1)for(var a=l[o].className,s=0,u=r.length;s<u;s++)if(r[s].template&&a.indexOf(r[s].field)>-1){this.templateDestroy(r[s],l[o].id);break}document.getElementById(l[o].id)&&t.detach(l[o])}for(o=0,i=n.length;o<i;o++){if(n[o].className.indexOf("e-template")>-1)for(a=n[o].className,s=0,u=r.length;s<u;s++)if(r[s].template&&a.indexOf(r[s].field)>-1){this.templateDestroy(r[s],n[o].id);break}t.detach(n[o])}var p;for(o=0,i=(p=e.nextElementSibling.querySelectorAll(".e-template:not(.e-control)")).length;o<i;o++)t.detach(p[o])},p.prototype.templateDestroy=function(e,l){var n=e.template.destroy;if(e.template&&e.template.destroy){var r;r=t.closest(document.getElementById(l),".e-rule-field").querySelectorAll(".e-template"),"string"==typeof n?(n=t.getValue(n,window))({elementId:l,elements:r}):e.template.destroy({elementId:l,elements:r})}},p.prototype.getDistinctValues=function(e,t){for(var l={},n=[],r=0,o=e.length;r<o;r++){var i=e[r][t];Number(e[r][t])===e[r][t]&&e[r][t]%1!=0&&(i=e[r][t].toString());var a={};i in l||(l[i]=1,a[t]=i,n.push(a))}return n},p.prototype.renderMultiSelect=function(e,t,l,r,i){var a,s=!1,u=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(e.field)>-1&&(s=!0,a=this.getDistinctValues(this.dataColl,e.field)),!this.dataColl.length&&i.length&&(u=!0);var p=new n.MultiSelect({dataSource:u?i:s?a:this.dataManager,query:new o.Query([e.field]),fields:{text:e.field,value:e.field},placeholder:this.l10n.getConstant("SelectValue"),value:r,mode:"CheckBox",width:"100%",change:this.changeValue.bind(this,l),close:this.closePopup.bind(this,l),actionBegin:this.multiSelectOpen.bind(this,t+"_valuekey"+l)});p.appendTo("#"+t+"_valuekey"+l),this.updateRules(p.element,r,0)},p.prototype.multiSelectOpen=function(e,l){if(this.dataSource instanceof o.DataManager){var n=document.getElementById(e),r=t.getComponent(t.closest(n,".e-rule-container").querySelector(".e-filter-input"),"dropdownlist");this.selectedColumn=r.getDataByValue(r.value);var i=this.selectedColumn.field,a=!1;this.dataColl[1]&&Object.keys(this.dataColl[1]).indexOf(i)>-1&&(a=!0),a||(l.cancel=!0,t.isBlazor()?this.bindBlazorMultiSelectData(n,i):this.bindMultiSelectData(n,i))}},p.prototype.bindBlazorMultiSelectData=function(e,t){return function(e,t,l,n){return new(l||(l=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function a(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){e.done?r(e.value):new l((function(t){t(e.value)})).then(i,a)}s((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function(){return function(e,t){function l(e){return function(t){return n([e,t])}}function n(l){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,o=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){s=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){s.label=l[1];break}if(6===l[0]&&s.label<i[1]){s.label=i[1],i=l;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(l);break}i[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],o=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}(this,(function(l){switch(l.label){case 0:return[4,this.getMultiSelectData(e,t)];case 1:return l.sent(),[2]}}))}))},p.prototype.bindMultiSelectData=function(e,t){this.getMultiSelectData(e,t)},p.prototype.getMultiSelectData=function(e,l){var n,r=this,i=new o.Deferred,a=this.dataManager.executeQuery((new o.Query).select(l)),s=t.getComponent(e,"multiselect");s.hideSpinner(),this.createSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),u.showSpinner(t.closest(e,".e-multi-select-wrapper").parentElement),a.then((function(o){n=o.actual&&o.actual.result?o.actual.result:o.result,r.dataColl=t.extend(r.dataColl,n,[],!0),s.dataSource=r.getDistinctValues(r.dataColl,l),u.hideSpinner(t.closest(e,".e-multi-select-wrapper").parentElement)})).catch((function(e){i.reject(e)}))},p.prototype.createSpinner=function(e){var l=this.createElement("span",{attrs:{class:"e-qb-spinner"}});e.appendChild(l),u.createSpinner({target:l,width:t.Browser.isDevice?"16px":"14px"})},p.prototype.closePopup=function(e,l){var n=document.getElementById(l.popup.element.id.replace("_popup","")),r=t.getComponent(n,"multiselect").value;this.updateRules(n,r,e)},p.prototype.processTemplate=function(e,l,n,r){var o=t.closest(e,".e-rule-container"),i=o.querySelectorAll(".e-template"),a=t.getComponent(o.querySelector(".e-rule-filter .e-filter-input"),"dropdownlist").index;i.length<2?l.template&&"string"==typeof l.template.write?t.getValue(l.template.write,window)({elements:i[0],values:n.value,operator:r.operator,dataSource:this.columns[a].values}):l.template&&l.template.write&&l.template.write({elements:i[0],values:n.value,operator:r.operator,dataSource:this.columns[a].values}):l.template&&"string"==typeof l.template.write?t.getValue(l.template.write,window)({elements:i,values:n.value,operator:r.operator,dataSource:this.columns[a].values}):l.template&&l.template.write&&l.template.write({elements:i,values:n.value,operator:r.operator,dataSource:this.columns[a].values})},p.prototype.getItemData=function(e){var l=t.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist");return this.columns[l.index]},p.prototype.setDefaultValue=function(e,l,n){var r=this.getItemData(e);if(t.isNullOrUndefined(r.value))return n?l?[0,0]:0:l?[]:"";if(l){if(!(r.value instanceof Array))return[r.value]}else if(r.value instanceof Array)return r.value[0];return r.value},p.prototype.renderStringValue=function(e,t,l,n,r){var o,a,s=this.getItemData(e);if(a=this.isImportRules||this.isPublic?t.value:this.setDefaultValue(e,!1,!1),"in"!==l&&"notin"!==l||!this.dataColl.length&&!s.values){"in"!==l&&"notin"!==l||(a=(o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1)).join(","));var u=new i.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,n)});u.appendTo("#"+e+"_valuekey"+n),u.value=a,u.dataBind()}else o=this.isImportRules?t.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(s,e,n,o,s.values),"Vertical"===this.displayMode||this.element.className.indexOf("e-device")>-1?r.style.width="100%":(r.style.width=null,r.style.minWidth="200px")},p.prototype.renderNumberValue=function(e,l,n,r,o,a,s){var u=this.getItemData(e),p=this.isImportRules||this.isPublic?l.value:this.setDefaultValue(e,!1,!0);if("in"!==n&&"notin"!==n||!this.dataColl.length&&!u.values)if("in"===n||"notin"===n){var d=(p=this.isImportRules?l.value:this.setDefaultValue(e,!0,!1)).join(","),c=new i.TextBox({placeholder:this.l10n.getConstant("SelectValue"),input:this.changeValue.bind(this,r)});c.appendTo("#"+e+"_valuekey"+r),c.value=d,c.dataBind()}else{var h=t.getComponent(document.getElementById(e+"_filterkey"),"dropdownlist"),m=(a=this.columns[h.index]).validation&&a.validation.min?a.validation.min:0,f=a.validation&&a.validation.max?a.validation.max:Number.MAX_VALUE,g=a.format?a.format:"n";s>1&&l&&(p=l.value[r]?l.value[r]:this.setDefaultValue(e,!0,!0)),new i.NumericTextBox({value:p instanceof Array?p[r]:p,format:g,min:m,max:f,width:"100%",step:a.step?a.step:1,change:this.changeValue.bind(this,r)}).appendTo("#"+e+"_valuekey"+r)}else p=this.isImportRules?l.value:this.setDefaultValue(e,!0,!1),this.renderMultiSelect(u,e,r,p,u.values),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?o.style.width="100%":(o.style.minWidth="200px",o.style.width=null)},p.prototype.processValueString=function(e,t){var l=[],n=e.split(",");if("string"===t)return n;for(var r=0,o=n.length;r<o;r++)l.push(Number(n[r]));return l},p.prototype.parseDate=function(e,l){var n,r;if(l){var o=this.intl.getDateParser({skeleton:"full",type:"dateTime"});n=this.getFormat(l),r=o(e),t.isNullOrUndefined(r)&&(r=this.intl.parseDate(e,n))}else r=new Date(e);return r},p.prototype.renderControls=function(e,n,r,o){if(t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-value"),t.removeClass([e.parentElement.querySelector(".e-rule-value")],"e-hide"),t.addClass([e.parentElement.querySelector(".e-rule-value")],"e-show"),n.template)this.processTemplate(e,n,r,o);else{var i;i="boolean"===o.type?this.selectedColumn.values?this.selectedColumn.values.length:2:o.operator&&o.operator.toLowerCase().indexOf("between")>-1?2:1;var s=t.closest(e,".e-rule-container").id,u=void 0;if(e.className.indexOf("e-rule-operator")>-1||e.className.indexOf("e-rule-filter")>-1){u=e.parentElement.querySelector(".e-rule-value"),this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?u.style.width="100%":"in"!==o.operator&&"notin"!==o.operator&&(u.style.width="200px");for(var p=0;p<i;p++)switch(o.type){case"string":this.renderStringValue(s,r,o.operator,p,u);break;case"number":this.renderNumberValue(s,r,o.operator,p,u,n,i);break;case"boolean":var d=n.values&&n.values.length?n.values:["True","False"],c=!1;"boolean"===r.type&&r.value?c=d[p].toLowerCase()===r.value.toString().toLowerCase():n.value?c=d[p].toLowerCase()===n.value.toString().toLowerCase():0===p&&(c=!0);var h=new l.RadioButton({label:d[p].toString(),name:s+"default",checked:c,value:d[p],change:this.changeValue.bind(this,p)});h.appendTo("#"+s+"_valuekey"+p),c&&this.updateRules(h.element,d[p],0);break;case"date":var m=new Date,f=void 0,g=void 0,y=n.format,v=void 0,b=this.l10n.getConstant("SelectValue");if(n.value&&(m=n.value instanceof Date?n.value:n.value instanceof Number?new Date(n.value):this.parseDate(n.value,n.format)),(this.isImportRules||this.isPublic)&&r&&r.value&&(g=this.getColumn(r.field),f=i>1?r.value[p]:r.value,m=this.parseDate(f,g.format),y=g.format),y){var C=this.getFormat(y);v=C.skeleton?new a.DatePicker({locale:this.getLocale(),value:m,placeholder:b,format:C,change:this.changeValue.bind(this,p)}):new a.DatePicker({value:m,locale:this.getLocale(),placeholder:b,format:C.format,change:this.changeValue.bind(this,p)})}else v=new a.DatePicker({locale:this.getLocale(),value:m,placeholder:b,change:this.changeValue.bind(this,p)});v.appendTo("#"+s+"_valuekey"+p),r.value||this.updateRules(document.getElementById(s+"_valuekey"+p),m)}}}},p.prototype.getOperatorIndex=function(e,t){var l,n=e.dataSource.length;for(l=0;l<n;l++)if(t.operator===e.dataSource[l].value)return l;return 0},p.prototype.renderValues=function(e,l,n,r,o,i,a){if(r){var s=t.getComponent(e.querySelector("input"),"dropdownlist");l.operators?(s.dataSource=l.operators,s.index=this.getOperatorIndex(s,o),s.value=i.operator=s.dataSource[s.index].value,s.dataBind()):l.type&&(s.dataSource=this.customOperators[l.type+"Operator"],s.index=this.getOperatorIndex(s,o),s.value=i.operator=s.dataSource[s.index].value,s.dataBind())}if(!(i.operator.indexOf("null")>-1||i.operator.indexOf("empty")>-1)){var u=t.closest(e,".e-rule-container").id;n&&n.template&&(this.templateDestroy(n,u+"_valuekey0"),t.detach(e.nextElementSibling.querySelector("#"+u+"_valuekey0"))),r&&this.destroyControls(e);var p=document.getElementById(a.id.replace("operatorkey","filterkey")),d=t.getComponent(p,"dropdownlist");if(l.template=this.columns[d.index].template,l.template){if(t.addClass([e.nextElementSibling],"e-template-value"),l.template=this.columns[d.index].template,g=void 0,l.template&&"string"==typeof l.template.create?g=t.getValue(l.template.create,window)({operator:l.value||i.operator}):l.template&&l.template.create&&(g=l.template.create({operator:l.value||i.operator})),g instanceof Element)g.id=u+"_valuekey0",t.addClass([g],"e-template"),t.addClass([g],"e-"+this.columns[d.index].field),e.nextElementSibling.appendChild(g);else if(g instanceof Array){t.addClass(g,"e-template");for(var c=0,h=g.length;c<h;c++)g[c].id=u+"_valuekey"+c,e.nextElementSibling.appendChild(g[c])}var m=e.parentElement.querySelector(".e-rule-value");this.element.className.indexOf("e-device")>-1||"Vertical"===this.displayMode?m.style.width="100%":m.style.width="200px"}else{t.removeClass([e.nextElementSibling],"e-template-value");var f;for(f="boolean"===i.type?this.selectedColumn.values?this.selectedColumn.values.length:2:i.operator&&i.operator.toLowerCase().indexOf("between")>-1?2:1,c=0;c<f;c++){var g=void 0;g=this.createElement("input",{attrs:{type:"text",id:u+"_valuekey"+c}}),e.nextElementSibling.appendChild(g)}}this.renderControls(e,l,o,i)}},p.prototype.updateValues=function(e,l){var n=1;e.className.indexOf("e-template")>-1&&(n=3);var r=e.className.split(" e-")[n],o=parseInt(e.id.slice(-1),2);switch(r){case"textbox":case"dropdownlist":l.value=t.getComponent(e,r).value;break;case"radio":var i=t.getComponent(e,r);i.checked&&(l.value=i.value),i.refresh();break;case"numerictextbox":l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[o]=t.getComponent(e,r).value):l.value=t.getComponent(e,r).value;break;case"datepicker":var a=this.getColumn(l.field),s=this.getFormat(a.format),u=t.getComponent(e,r).value;l.operator.indexOf("between")>-1?("string"==typeof l.value&&(l.value=[]),l.value[o]=u):t.isNullOrUndefined(s.format)&&u?l.value=this.intl.formatDate(u):l.value=u?this.intl.formatDate(u,s):"";break;case"multiselect":l.value=t.getComponent(e,r).value}},p.prototype.updateRules=function(e,l,n){for(var r,o,i,a=t.closest(e,".e-group-container"),s=this.getParentGroup(a),u=t.closest(e,".e-rule-container"),p=0,d=a.id.replace(this.element.id+"_",""),c=this.getValidRules(this.rule);u&&null!==u.previousElementSibling;)u=u.previousElementSibling,p++;if(i=(u=t.closest(e,".e-rule-container")).id.replace(this.element.id+"_",""),t.closest(e,".e-rule-filter")){r=t.getComponent(e,"dropdownlist"),this.isImportRules||s.rules[p].field.toLowerCase()===this.columns[r.index].field.toLowerCase()||(!u.querySelectorAll(".e-template")&&!(s.rules[p].operator.indexOf("null")>-1)||s.rules[p].operator.indexOf("empty")>-1)&&(s.rules[p].value=""),this.selectedColumn=r.getDataByValue(r.value),s.rules[p].field=this.selectedColumn.field,s.rules[p].type=this.selectedColumn.type,s.rules[p].label=this.selectedColumn.label;var h=t.closest(e,".e-rule-filter"),m=h.nextElementSibling.querySelector("input.e-control"),f=t.getComponent(m,"dropdownlist").value;s.rules[p].operator=f;var g=h.nextElementSibling.nextElementSibling,y=g.querySelectorAll("input.e-control");y.length<1&&(y=g.querySelectorAll(".e-template"));for(var v=0;v<y.length;v++)y[v]||(y[v]=h.nextElementSibling.nextElementSibling.querySelector("div.e-control")),y[v]||(y[v]=h.nextElementSibling.nextElementSibling.querySelector(".e-template")),o={groupID:d,ruleID:i,value:s.rules[p].field,type:"field"},s.rules[p].operator.indexOf("null")>-1||s.rules[p].operator.indexOf("empty")>-1?s.rules[p].value=null:this.updateValues(y[v],s.rules[p]);this.isImportRules||this.trigger("change",o),this.allowValidation&&s.rules[p].field&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),this.filterRules(c,this.getValidRules(this.rule),"field")}else if(t.closest(e,".e-rule-operator")){r=t.getComponent(e,"dropdownlist"),s.rules[p].operator=r.value;var b=void 0;e.parentElement,b=u.querySelectorAll(".e-rule-value input.e-control"),o={groupID:d,ruleID:i,value:r.value,type:"operator"},this.allowValidation&&s.rules[p].operator&&e.parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(e.parentElement,"tooltip").destroy(),b.length>1&&!(b[0].className.indexOf("e-template")>-1)&&(s.rules[p].value=[]);for(var C=0;C<b.length;C++)s.rules[p].operator.indexOf("null")>-1||s.rules[p].operator.indexOf("empty")>-1?s.rules[p].value=null:b[C].classList.contains("e-template")||this.updateValues(b[C],s.rules[p]);this.isImportRules||this.trigger("change",o),this.filterRules(c,this.getValidRules(this.rule),"operator")}else t.closest(e,".e-rule-value")&&(this.ruleValueUpdate(e,l,s,p,a,u,n),this.filterRules(c,this.getValidRules(this.rule),"value"))},p.prototype.filterRules=function(e,t,l){JSON.stringify({condition:e.condition,not:e.not,rule:e.rules})!==JSON.stringify({condition:t.condition,not:t.not,rule:t.rules})&&(this.isImportRules||this.trigger("ruleChange",{previousRule:e,rule:t,type:l}))},p.prototype.ruleValueUpdate=function(e,l,r,o,i,a,s){var u,p,d=["in","between","notin","notbetween"];if(null!==l){if(r.rules[o].operator&&(p=r.rules[o].operator.toLowerCase()),e.className.indexOf("e-multiselect")>-1&&"number"===r.rules[o].type&&!(e.className.indexOf("e-template")>-1)){for(var c=[],h=l,m=0,f=h.length;m<f;m++)"string"==typeof h[m]&&c.push(parseFloat(h[m]));c.length&&(l=c)}if(e.className.indexOf("e-template")>-1)r.rules[o].value=l,u={groupID:i.id,ruleID:a.id,value:r.rules[o].value,type:"value"},this.isImportRules||this.trigger("change",u);else if(e.className.indexOf("e-spin")>-1||e.className.indexOf("e-numeric")>-1)d.indexOf(p)>-1?r.rules[o].value[s]=l:r.rules[o].value=l;else if(e.className.indexOf("e-radio")>-1)r.rules[o].value=l;else if(e.className.indexOf("e-multiselect")>-1)r.rules[o].value=l;else if(e.className.indexOf("e-textbox")>-1)"in"===p||"notin"===p?(r.rules[o].type,r.rules[o].value=this.processValueString(l,r.rules[o].type)):r.rules[o].value=l;else if(e.className.indexOf("e-datepicker")>-1){var g=t.getInstance(a.querySelector(".e-rule-filter input"),n.DropDownList),y=this.getFormat(this.columns[g.index].format);y.type&&(d.indexOf(p)>-1?("string"==typeof r.rules[o].value&&(r.rules[o].value=[]),r.rules[o].value[s]=this.intl.formatDate(l,y)):r.rules[o].value=this.intl.formatDate(l,y))}this.validatValue(r,o,a)}},p.prototype.validatValue=function(e,l,n){if(this.allowValidation&&e.rules[l].value){var r=n.querySelectorAll(".e-rule-value .e-control");r[0].className.indexOf("e-tooltip")>-1?t.getComponent(r[0],"tooltip").destroy():r[0].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(r[0].parentElement,"tooltip").destroy(),r[1]&&r[1].parentElement.className.indexOf("e-tooltip")>-1&&t.getComponent(r[1].parentElement,"tooltip").destroy()}},p.prototype.getFormat=function(e){var t;return e?"string"==typeof e?(t={type:"dateTime",format:e},"short"===e&&(t.skeleton=e)):t={type:"dateTime",skeleton:e.skeleton}:t={type:"dateTime",skeleton:"yMd"},t},p.prototype.findGroupByIdx=function(e,t,l){var n=t.rules,r=[];if(!l){for(var o=0,i=n.length;o<i;o++)(t=n[o]).rules&&r.push(t);return r[e]}return t},p.prototype.destroy=function(){if(this.element){var l,n,r,o;for(e.prototype.destroy.call(this),r=(l=this.element.querySelectorAll(".e-addrulegroup")).length,n=0;n<r;n++)t.getComponent(l[n],"dropdown-btn").destroy(),t.detach(l[n]);for(o=this.element.querySelectorAll(".e-rule-filter .e-control.e-tooltip"),n=0;n<o.length;n++)t.getComponent(o[n],"tooltip").destroy();for(r=(l=this.element.querySelectorAll(".e-rule-filter .e-control:not(.e-tooltip)")).length,n=0;n<r;n++)t.getComponent(l[n],"dropdownlist").destroy(),t.detach(l[n]);for(o=this.element.querySelectorAll(".e-rule-operator .e-control.e-tooltip"),n=0;n<o.length;n++)t.getComponent(o[n],"tooltip").destroy();for(r=(l=this.element.querySelectorAll(".e-rule-operator .e-control:not(.e-tooltip)")).length,n=0;n<r;n++)t.getComponent(l[n],"dropdownlist").destroy(),t.detach(l[n]);for(o=this.element.querySelectorAll(".e-rule-value .e-control.e-tooltip"),n=0;n<o.length;n++)t.getComponent(o[n],"tooltip").destroy();this.isImportRules=!1,this.unWireEvents(),this.levelColl[this.element.id+"_group0"]=[0],this.element.innerHTML="",t.classList(this.element,[],["e-rtl","e-responsive","e-device"])}},p.prototype.addRules=function(e,t){t=this.element.id+"_"+t,this.isPublic=!0;for(var l=0,n=e.length;l<n;l++)this.addRuleElement(document.getElementById(t),e[l]);this.isPublic=!1},p.prototype.addGroups=function(e,t){t=this.element.id+"_"+t;var l=document.getElementById(t),n=this.getParentGroup(l);if(e.length)for(var r=0,o=e.length;r<o;r++)this.importRules(e[r],l);else this.enableNotCondition?n.rules.push({condition:"and",not:!1,rules:[]}):n.rules.push({condition:"and",rules:[]});var i=l.querySelector(".e-btngroup-and"),a=l.querySelector(".e-btngroup-or");i.disabled&&(i.removeAttribute("disabled"),i.checked=!0,a.removeAttribute("disabled"))},p.prototype.initWrapper=function(){if(this.isInitialLoad=!0,this.cssClass&&t.addClass([this.element],this.cssClass),this.enableRtl&&t.addClass([this.element],"e-rtl"),this.width&&(this.element.style.width=this.width),this.height&&(this.element.style.height=this.height),this.rule.rules.length?this.isImportRules=!0:this.addGroupElement(!1,this.element),t.Browser.isDevice||"Vertical"===this.displayMode?(t.Browser.isDevice&&(this.element.style.width="100%",this.element.classList.add("e-device")),t.removeClass(this.element.querySelectorAll(".e-rule-container"),"e-horizontal-mode"),t.addClass(this.element.querySelectorAll(".e-rule-container"),"e-vertical-mode"),this.displayMode="Vertical"):this.displayMode="Horizontal",this.summaryView)this.isImportRules?this.renderSummary():this.renderSummaryCollapse();else{if(this.columns.length&&this.isImportRules){this.addGroupElement(!1,this.element,this.rule.condition);var e=t.extend({},this.rule,{},!0);this.setGroupRules(e)}else this.columns.length&&this.addRuleElement(this.element.querySelector(".e-group-container"),{});this.notGroupRtl();for(var l=this.element.querySelectorAll("label.e-btn"),n=void 0,r=0;r<l.length;r++)n=l.item(r),t.rippleEffect(n,{selector:".e-btn"})}},p.prototype.renderSummary=function(){var e=this.createElement("div",{attrs:{class:"e-summary-content",id:this.element.id+"_summary_content"}}),t=this.createElement("textarea",{attrs:{class:"e-summary-text",readonly:"true"},styles:"max-height:500px"}),l=this.createElement("button",{attrs:{class:"e-edit-rule e-css e-btn e-small e-flat e-primary"}}),n=this.createElement("div",{attrs:{class:"e-summary-btndiv"}});e.appendChild(t),t.textContent=this.getSqlFromRules(this.rule),l.textContent=this.l10n.getConstant("Edit"),n.appendChild(l),e.appendChild(n),this.element.appendChild(e)},p.prototype.renderSummaryCollapse=function(){var e=this.createElement("div",{attrs:{class:"e-collapse-rule e-icons",title:this.l10n.getConstant("SummaryViewTitle")}});this.element.querySelector(".e-group-header").appendChild(e)},p.prototype.columnSort=function(){"descending"===this.sortDirection.toLowerCase()?this.columns=new o.DataManager(this.columns).executeLocal((new o.Query).sortByDesc("field")):"ascending"===this.sortDirection.toLowerCase()&&(this.columns=new o.DataManager(this.columns).executeLocal((new o.Query).sortBy("field")))},p.prototype.onChangeNotGroup=function(){if(this.element.innerHTML="",this.groupIdCounter=0,this.enableNotCondition){if(this.enableNotCondition){var e=this.createElement("button",{attrs:{type:"button",class:"e-qb-toggle"}});this.groupElem.querySelector(".e-btn-group").insertBefore(e,this.groupElem.querySelector(".e-btngroup-and"))}}else this.groupElem.querySelector(".e-qb-toggle").remove();this.rule=this.checkNotGroup(this.rule),this.initWrapper()},p.prototype.notGroupRtl=function(){this.enableRtl?t.addClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl"):t.removeClass(this.element.querySelectorAll(".e-btn-group"),"e-rtl")},p.prototype.checkNotGroup=function(e){var l;if(e.rules)for(var n=0;n<e.rules.length;n++)l=e.rules[n],l=this.checkNotGroup(l),e.rules[n]=l;return t.isNullOrUndefined(e.not)?this.enableNotCondition&&!t.isNullOrUndefined(e.condition)&&(e.not=!1):(this.enableNotCondition&&(e.not=!1),delete e.not),e},p.prototype.onPropertyChanged=function(e,l){for(var n=0,r=Object.keys(e);n<r.length;n++)switch(r[n]){case"summaryView":var o=this.element.querySelector(".e-group-container"),i=this.element.querySelector(".e-summary-content");e.summaryView?(o.style.display="none",this.element.querySelectorAll(".e-summary-content").length<1?(this.renderSummary(),i=this.element.querySelector(".e-summary-content")):this.element.querySelector(".e-summary-text").textContent=this.getSqlFromRules(this.rule),i.style.display="block"):(o.querySelectorAll(".e-collapse-rule").length>-1&&this.renderSummaryCollapse(),o.style.display="block",i.style.display="none");break;case"displayMode":this.refresh();break;case"showButtons":e.showButtons.ruleDelete?t.removeClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-rule-delete"),"e-button-hide"),e.showButtons.groupDelete?t.removeClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide"):t.addClass(this.element.querySelectorAll(".e-deletegroup"),"e-button-hide");break;case"cssClass":l.cssClass&&t.removeClass([this.element],l.cssClass.split(" ")),e.cssClass&&t.addClass([this.element],e.cssClass.split(" "));break;case"enableRtl":e.enableRtl?(t.addClass([this.element],"e-rtl"),this.notGroupRtl()):(t.removeClass([this.element],"e-rtl"),this.notGroupRtl());break;case"enablePersistence":this.enablePersistence=e.enablePersistence;break;case"dataSource":this.dataSource=e.dataSource;break;case"columns":this.columns=e.columns,this.columnSort();break;case"sortDirection":this.sortDirection=e.sortDirection,this.columnSort();break;case"maxGroupCount":this.maxGroupCount=e.maxGroupCount;break;case"height":this.height=e.height,this.element.style.height=this.height;break;case"rule":this.rule=e.rule,e.rule=this.getRuleCollection(this.rule,!1);break;case"width":this.width=e.width,this.element.style.width=this.width;break;case"locale":this.locale=e.locale,this.intl=new t.Internationalization(this.locale),this.refresh();break;case"enableNotCondition":this.onChangeNotGroup()}},p.prototype.preRender=function(){this.defaultLocale={StartsWith:"Starts With",EndsWith:"Ends With",Contains:"Contains",Equal:"Equal",NotEqual:"Not Equal",LessThan:"Less Than",LessThanOrEqual:"Less Than Or Equal",GreaterThan:"Greater Than",GreaterThanOrEqual:"Greater Than Or Equal",Between:"Between",NotBetween:"Not Between",In:"In",NotIn:"Not In",Remove:"REMOVE",SelectField:"Select a field",SelectOperator:"Select operator",DeleteRule:"Remove this condition",DeleteGroup:"Delete group",AddGroup:"Add Group",AddCondition:"Add Condition",Edit:"EDIT",ValidationMessage:"This field is required",SummaryViewTitle:"Summary View",OtherFields:"Other Fields",AND:"AND",OR:"OR",NOT:"NOT",SelectValue:"Enter Value",IsEmpty:"Is Empty",IsNotEmpty:"Is Not Empty",IsNull:"Is Null",IsNotNull:"Is Not Null"},this.l10n=new t.L10n("querybuilder",this.defaultLocale,this.locale),this.intl=new t.Internationalization(this.locale),this.groupIdCounter=0,this.ruleIdCounter=0,this.btnGroupId=0,this.isImportRules=!1,this.parser=[],this.customOperators={stringOperator:[{value:"startswith",key:this.l10n.getConstant("StartsWith")},{value:"endswith",key:this.l10n.getConstant("EndsWith")},{value:"contains",key:this.l10n.getConstant("Contains")},{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")},{value:"isempty",key:this.l10n.getConstant("IsEmpty")},{value:"isnotempty",key:this.l10n.getConstant("IsNotEmpty")},{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}],dateOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],booleanOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"notequal",key:this.l10n.getConstant("NotEqual")}],numberOperator:[{value:"equal",key:this.l10n.getConstant("Equal")},{value:"greaterthanorequal",key:this.l10n.getConstant("GreaterThanOrEqual")},{value:"greaterthan",key:this.l10n.getConstant("GreaterThan")},{value:"between",key:this.l10n.getConstant("Between")},{value:"lessthan",key:this.l10n.getConstant("LessThan")},{value:"notbetween",key:this.l10n.getConstant("NotBetween")},{value:"lessthanorequal",key:this.l10n.getConstant("LessThanOrEqual")},{value:"notequal",key:this.l10n.getConstant("NotEqual")},{value:"in",key:this.l10n.getConstant("In")},{value:"notin",key:this.l10n.getConstant("NotIn")},{value:"isnull",key:this.l10n.getConstant("IsNull")},{value:"isnotnull",key:this.l10n.getConstant("IsNotNull")}]},this.operators={equal:"=",notequal:"!=",greaterthan:">",greaterthanorequal:">=",lessthan:"<",in:"IN",notin:"NOT IN",lessthanorequal:"<=",startswith:"LIKE",endswith:"LIKE",between:"BETWEEN",notbetween:"NOT BETWEEN",contains:"LIKE",isnull:"IS NULL",isnotnull:"IS NOT NULL",isempty:"IS EMPTY",isnotempty:"IS NOT EMPTY",notstartswith:"NOT LIKE",notendswith:"NOT LIKE",notcontains:"NOT LIKE"},this.fields={text:"label",value:"field"}},p.prototype.render=function(){this.levelColl={},this.items=[{text:this.l10n.getConstant("AddGroup"),iconCss:"e-icons e-add-icon e-addgroup"},{text:this.l10n.getConstant("AddCondition"),iconCss:"e-icons e-add-icon e-addrule"}],this.ruleElem=this.ruleTemplate(),this.groupElem=this.groupTemplate(),this.dataSource instanceof o.DataManager?(this.dataManager=this.dataSource,this.executeDataManager((new o.Query).take(1))):(this.dataManager=new o.DataManager(this.dataSource),this.dataColl=this.dataManager.executeLocal(new o.Query),this.initControl()),this.renderComplete()},p.prototype.executeDataManager=function(e){var t=this,l=this.dataManager.executeQuery(e),n=new o.Deferred;l.then((function(e){e.actual&&e.actual.result?t.dataColl=e.actual.result:t.dataColl=e.result,t.initControl()})).catch((function(e){n.reject(e)}))},p.prototype.initControl=function(){this.initialize(),this.initWrapper(),this.wireEvents()},p.prototype.wireEvents=function(){var e=this.getWrapper();t.EventHandler.add(e,"click",this.clickEventHandler,this)},p.prototype.unWireEvents=function(){var e=this.getWrapper();t.EventHandler.remove(e,"click",this.clickEventHandler)},p.prototype.getParentGroup=function(e,t){for(var l=e instanceof Element?this.levelColl[e.id]:this.levelColl[e],n=t?l.length-1:l.length,r=this.rule,o=0;o<n;o++)r=this.findGroupByIdx(l[o],r,0===o);return r},p.prototype.deleteGroup=function(e){var t=this,l={groupID:e.id.replace(this.element.id+"_",""),cancel:!1,type:"deleteGroup"};this.isImportRules?this.deleteGroupSuccessCallBack(l,e):this.trigger("beforeChange",l,(function(l){t.deleteGroupSuccessCallBack(l,e)}))},p.prototype.deleteGroupSuccessCallBack=function(e,l){if(!e.cancel){this.actionButton&&t.getComponent(this.actionButton,"tooltip").destroy();var n=l,r=this.getParentGroup(n,!0),o=0,i=void 0,a=void 0,s=this.getValidRules(this.rule),u=n.nextElementSibling,p=n.previousElementSibling,d=n.querySelectorAll(".e-group-container"),c=n.querySelectorAll(".e-tooltip");for(a=c.length,i=0;i<a;i++)t.getComponent(c[i],"tooltip").destroy();for(i=0,a=d.length;i<a;i++)delete this.levelColl[d[i].id];for(;null!==n.previousElementSibling;)n=n.previousElementSibling,o++;u&&u.className.indexOf("e-separate-rule")>-1&&(t.removeClass([u],"e-separate-rule"),t.addClass([u],"e-joined-rule"),p&&p.className.indexOf("e-rule-container")>-1&&t.addClass([p],"e-prev-joined-rule")),r.rules.splice(o,1),delete this.levelColl[e.groupID];var h=n.parentElement.parentElement.parentElement;t.detach(l),this.refreshLevelColl(),this.disableRuleCondition(h,r),this.isImportRules||this.trigger("change",e),this.filterRules(s,this.getValidRules(this.rule),"deleteGroup")}},p.prototype.deleteRule=function(e){var l=this,n={groupID:t.closest(e,".e-group-container").id.replace(this.element.id+"_",""),ruleID:t.closest(e,".e-rule-container").id.replace(this.element.id+"_",""),cancel:!1,type:"deleteRule"};this.isImportRules?this.deleteRuleSuccessCallBack(n,e):this.trigger("beforeChange",n,(function(t){l.deleteRuleSuccessCallBack(t,e)}))},p.prototype.deleteRuleSuccessCallBack=function(e,l){if(!e.cancel){this.actionButton&&this.actionButton.className.indexOf("e-tooltip")>-1&&t.getComponent(this.actionButton,"tooltip").destroy();var n=t.closest(l,".e-group-container"),r=this.getParentGroup(n),o=t.closest(l,".e-rule-container"),i=this.getValidRules(this.rule),a=o,s=o.nextElementSibling,u=o.previousElementSibling,p=0,d=o.querySelectorAll(".e-tooltip"),c=void 0,h=d.length;for(c=0;c<h;c++)t.getComponent(d[c],"tooltip").destroy();for(;null!==o.previousElementSibling;)o=o.previousElementSibling,p++;r.rules.splice(p,1),(!u||u.className.indexOf("e-rule-container")<0)&&s&&t.removeClass([s],"e-joined-rule"),(!s||s.className.indexOf("e-rule-container")<0)&&u&&t.removeClass([u],"e-prev-joined-rule"),t.detach(a),r.rules[0]&&r.rules[0].rules||this.disableRuleCondition(n,r),this.isImportRules||this.trigger("change",e),this.filterRules(i,this.getValidRules(this.rule),"deleteRule")}},p.prototype.setGroupRules=function(e){this.reset(),this.groupIdCounter=1,this.ruleIdCounter=0,this.isImportRules=!0,this.rule=e,e=this.getRuleCollection(this.rule,!1),this.importRules(this.rule,this.element.querySelector(".e-group-container"),!0),this.isImportRules=!1},p.prototype.disableRuleCondition=function(e,t){var l=e.querySelector(".e-rule-list").childElementCount,n=e.querySelector(".e-btngroup-and"),r=e.querySelector(".e-btngroup-or");l>1?(n.disabled=!1,r.disabled=!1,t&&"or"===t.condition?r.checked=!0:n.checked=!0):(n.checked=!1,n.disabled=!0,r.checked=!1,r.disabled=!0)},p.prototype.getValidRules=function(e){var l=e.condition,n=e.not,r=t.extend([],e.rules,[],!0);return this.getRuleCollection({condition:l,rules:r,not:n},!0)},p.prototype.getRuleCollection=function(e,t){var l;if(e.rules&&e.rules.length&&(Object.keys(e.rules[0]).length>6||t))for(var n=e.rules.length,r=0;r<n;r++)l=e.rules[r],l=this.getRuleCollection(l,t),e.rules[r]=l,Object.keys(l).length<1&&t&&(e.rules.splice(r,1),r--,n--);return e.condition||""===e.condition?e=this.enableNotCondition?{condition:e.condition,rules:e.rules,not:e.not}:{condition:e.condition,rules:e.rules}:(e.operator&&(e.operator.indexOf("null")>-1||e.operator.indexOf("empty")>-1)&&(e.value=null),e=""!==e.field&&""!==e.operator&&""!==e.value?{label:e.label,field:e.field,operator:e.operator,type:e.type,value:e.value}:{}),e},p.prototype.setRules=function(e){var l=t.extend({},e,{},!0);this.setGroupRules(l)},p.prototype.getRules=function(){return this.enableNotCondition?{condition:this.rule.condition,rules:this.rule.rules,not:this.rule.not}:{condition:this.rule.condition,rules:this.rule.rules}},p.prototype.getRule=function(e){var l,n,r=0;e instanceof HTMLElement?l=t.closest(e,".e-rule-container"):(n=this.element.id+"_"+e,l=document.getElementById(n));for(var o=t.closest(l,".e-group-container"),i=this.getParentGroup(o);null!==l.previousElementSibling;)l=l.previousElementSibling,r++;return i.rules[r]},p.prototype.getGroup=function(e){e instanceof Element&&e.className.indexOf("e-group-container")<1&&(e=t.closest(e,".e-group-container"));var l=e instanceof Element?e.id:this.element.id+"_"+e,n=this.getParentGroup(l);return{rules:n.rules,condition:n.condition}},p.prototype.deleteGroups=function(e){var t,l,n=e.length;for(t=0;t<n;t++)l=this.element.id+"_"+e[t],this.deleteGroup(document.getElementById(l))},p.prototype.getFilteredRecords=function(){var e,l=this.getPredicate(this.getValidRules(this.rule));if(e=t.isNullOrUndefined(l)?new o.Query:(new o.Query).where(l),t.isBlazor()){var n=new o.UrlAdaptor,r=new o.DataManager({url:"",adaptor:new o.UrlAdaptor}),i=n.processQuery(r,e),a=JSON.parse(i.data);return Object.keys(a).length?a:null}return this.dataManager.executeQuery(e)},p.prototype.deleteRules=function(e){var t,l,n=e.length;for(t=0;t<n;t++)l=this.element.id+"_"+e[t],this.deleteRule(document.getElementById(l))},p.prototype.getDataManagerQuery=function(e){for(var t=this.getPredicate(e),l=[],n=0,r=Object.keys(this.columns);n<r.length;n++)l.push(this.columns[n].field);return e.rules.length?(new o.Query).select(l).where(t):(new o.Query).select(l)},p.prototype.getPredicate=function(e){var t,l,n,r,i=e.rules,a=!1,s=["notcontains","notstartswith","notendswith"];if(!i)return t;for(var u=0,p=i.length;u<p;u++)if(a=!1,Object.keys(i[u]).indexOf("rules")>-1&&i[u].rules)(l=this.getPredicate(i[u]))&&(t=t?"and"===e.condition?t.and(l):t.or(l):l);else if(i[u].operator.length){var d=i[u].operator.toLowerCase(),c=!1,h=["equal","notequal","greaterthan","lessthanorequal"];if("string"===i[u].type&&(a=!this.matchCase),"date"===i[u].type&&h.indexOf(d)>-1&&(a=!0),r=this.getColumn(i[u].field),"date"!==i[u].type||i[u].value instanceof Array)i[u].operator.indexOf("null")>-1||i[u].operator.indexOf("empty")>-1?i[u].value=null:n=i[u].value;else{var m=this.getFormat(r.format);n=this.getDate(i[u].value,m),h.indexOf(d)>-1&&(c=!0)}if(0===u)c||(d.indexOf("in")>-1||d.indexOf("between")>-1||d.indexOf("null")>-1||d.indexOf("empty")>-1)&&d.indexOf("contains")<0?t=c?this.datePredicate(i[u],n):this.arrayPredicate(i[u]):""!==(f=n)&&s.indexOf(d)<0&&(t=new o.Predicate(i[u].field,i[u].operator,n,a));else{if(s.indexOf(d)>-1)continue;if(c||(d.indexOf("in")>-1||d.indexOf("between")>-1||d.indexOf("null")>-1||d.indexOf("empty")>-1)&&d.indexOf("contains")<0)t=c?this.datePredicate(i[u],n,t,e.condition):this.arrayPredicate(i[u],t,e.condition);else if("and"===e.condition)f=n,t&&""!==f?t=t.and(i[u].field,i[u].operator,n,a):""!==f&&(t=new o.Predicate(i[u].field,i[u].operator,n,a));else{var f=n;t&&""!==f?t=t.or(i[u].field,i[u].operator,n,a):""!==f&&(t=new o.Predicate(i[u].field,i[u].operator,n,a))}}}return t},p.prototype.getLocale=function(){var e=this.locale;return t.getValue("main."+this.locale+".dates.calendars.gregorian.days.format.short",t.cldrData)||(e="en"),e},p.prototype.getColumn=function(e){for(var t,l=this.columns,n=0,r=l.length;n<r;n++)l[n].field===e&&(t=l[n]);return t},p.prototype.datePredicate=function(e,t,l,n){var r,i=new Date(t.getTime()),a=new Date(i.setDate(i.getDate()+1));switch(e.operator){case"equal":r=(r=new o.Predicate(e.field,"greaterthanorequal",t)).and(e.field,"lessthan",a);break;case"notequal":r=(r=new o.Predicate(e.field,"lessthan",t)).or(e.field,"greaterthanorequal",a);break;case"greaterthan":r=new o.Predicate(e.field,"greaterthanorequal",a);break;case"lessthanorequal":r=new o.Predicate(e.field,"lessthan",a)}return r&&(l?"and"===n?l=l.and(r):"or"===n&&(l=l.or(r)):l=r),l},p.prototype.arrayPredicate=function(e,t,l){var n,r,i=e.value,a=e.value,s=this.getColumn(e.field);if(n=this.getFormat(s.format),e.operator.indexOf("null")>-1||e.operator.indexOf("empty")>-1)switch(e.operator){case"isnull":r=new o.Predicate(e.field,"isnull",a);break;case"isnotnull":r=new o.Predicate(e.field,"notnull",a);break;case"isempty":r=new o.Predicate(e.field,"equal","");break;case"isnotempty":r=new o.Predicate(e.field,"notequal","")}if(!(e.operator.indexOf("null")>-1||e.operator.indexOf("empty")>-1))for(var u=0,p=i.length;u<p;u++)if(""!==i[u])if(0===u)switch(e.operator){case"between":r="date"===s.type?new o.Predicate(e.field,"greaterthanorequal",this.getDate(i[u],n)):new o.Predicate(e.field,"greaterthanorequal",i[u]);break;case"notbetween":r="date"===s.type?new o.Predicate(e.field,"lessthan",this.getDate(i[u],n)):new o.Predicate(e.field,"lessthan",i[u]);break;case"in":r=new o.Predicate(e.field,"equal",i[u]);break;case"notin":r=new o.Predicate(e.field,"notequal",i[u])}else switch(e.operator){case"between":if("date"===s.type){var d=this.getDate(i[u],n),c=new Date(d.setDate(d.getDate()+1));r=r.and(e.field,"lessthan",c)}else r=r.and(e.field,"lessthanorequal",i[u]);break;case"notbetween":r="date"===s.type?r.or(e.field,"greaterthan",this.getDate(i[u],n)):r.or(e.field,"greaterthan",i[u]);break;case"in":r=r.or(e.field,"equal",i[u]);break;case"notin":r=r.and(e.field,"notequal",i[u])}return r&&(t?"and"===l?t=t.and(r):"or"===l&&(t=t.or(r)):t=r),t},p.prototype.getDate=function(e,t){var l=this.intl.parseDate(e,t);return e.indexOf(":")>-1&&(e.indexOf("/")<0||e.indexOf(",")<0)&&l.setDate((new Date).getDate()),l},p.prototype.importRules=function(e,l,n){if(n){if(e.rules.length>1){var r=l.querySelector(".e-btngroup-or"),o=l.querySelector(".e-btngroup-and");r.disabled=!1,o.disabled=!1,"or"===e.condition?r.checked=!0:o.checked=!0}else this.disableRuleCondition(l);if(this.enableNotCondition){var i=l.querySelector(".e-qb-toggle");e.not?t.addClass([i],"e-active-toggle"):t.removeClass([i],"e-active-toggle")}}else l=this.renderGroup(e.condition,l);var a=e.rules;if(!t.isNullOrUndefined(a))for(var s=0,u=a.length;s<u;s++){var p=Object.keys(a[s]);!t.isNullOrUndefined(a[s].rules)&&p.indexOf("rules")>-1?(l=this.renderGroup(a[s].condition,l),l=this.importRules(a[s],l,!0)):this.renderRule(a[s],l)}return(l=t.closest(l,".e-rule-list"))&&(l=t.closest(l,".e-group-container")),l},p.prototype.renderGroup=function(e,t){this.addGroupElement(!0,t,e);var l=t.querySelectorAll(".e-group-container");return l[l.length-1]},p.prototype.renderRule=function(e,t){t.className.indexOf("e-group-container")>-1?this.addRuleElement(t,e):this.addRuleElement(t.querySelector(".e-group-container"),e)},p.prototype.getSqlString=function(e,t,l){var n=!1;l||""===l?l+="(":(l="",n=!0);var r=e.condition;e.not&&(l+=n?"not (":" not (");for(var o=0,i=e.rules.length;o<i;o++){if(e.rules[o].rules)l=this.getSqlString(e.rules[o],t,l);else{var a=e.rules[o],s="";if(a.value instanceof Array)if(a.operator.indexOf("between")>-1)"date"===a.type?s+='"'+a.value[0]+'" AND "'+a.value[1]+'"':s+=a.value[0]+" AND "+a.value[1];else if("string"==typeof a.value[0]){s+='("'+a.value[0]+'"';for(var u=1,p=a.value.length;u<p;u++)s+=',"'+a.value[u]+'"';s+=")"}else s+="("+a.value+")";else a.operator.indexOf("startswith")>-1?s+='("'+a.value+'%")':a.operator.indexOf("endswith")>-1?s+='("%'+a.value+'")':a.operator.indexOf("contains")>-1?s+='("%'+a.value+'%")':"number"===a.type?s+=a.value:s+='"'+a.value+'"';a.operator.indexOf("null")>-1||a.operator.indexOf("empty")>-1?(t&&(a.field="`"+a.field+"`"),l+=a.field+" "+this.operators[a.operator]):(t&&(a.field="`"+a.field+"`"),l+=a.field+" "+this.operators[a.operator]+" "+s)}o!==i-1&&(l+=" "+r+" ")}return n||(l+=")"),e.not&&(l+=")"),l},p.prototype.setRulesFromSql=function(e){e=e.replace(/`/g,"");var t=this.getRulesFromSql(e);this.setRules({condition:t.condition,not:t.not,rules:t.rules})},p.prototype.getRulesFromSql=function(e){this.parser=[],this.sqlParser(e),this.rule={condition:"and",not:!1,rules:[]};var t=this.processParser(this.parser,this.rule,[0]);return this.enableNotCondition?{condition:t.condition,not:t.not,rules:t.rules}:{condition:t.condition,rules:t.rules}},p.prototype.getSqlFromRules=function(e,t){return e=this.getRuleCollection(e,!1),this.getSqlString(this.getValidRules(e),t).replace(/"/g,"'")},p.prototype.sqlParser=function(e){var t,l=0;do{t=e.slice(l),l+=this.parseSqlStrings(t)}while(""!==t);return this.parser},p.prototype.parseSqlStrings=function(e){for(var t,l,n=["=","!=","<=",">=","<",">"],r=["and","or","not"],o=["IN","NOT IN","LIKE","NOT LIKE","BETWEEN","NOT BETWEEN","IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"],i=0,a=n.length;i<a;i++)if(t=/^\w+$/.test(n[i])?"\\b":"",new RegExp("^("+n[i]+")"+t,"ig").exec(e))return this.parser.push(["Operators",n[i].toLowerCase()]),n[i].length;var s=this.parser[this.parser.length-1];if(!s||s&&"Literal"!==s[0])for(i=0,a=r.length;i<a;i++)if(t=/^\w+$/.test(r[i])?"\\b":"",new RegExp("^("+r[i]+")"+t,"ig").exec(e))return this.parser.push(["Conditions",r[i].toLowerCase()]),r[i].length;for(i=0,a=o.length;i<a;i++)if(t=/^\w+$/.test(o[i])?"\\b":"",new RegExp("^("+o[i]+")"+t,"ig").exec(e))return this.parser.push(["SubOperators",o[i].toLowerCase()]),o[i].length;return/^\(/.exec(e)?(this.parser.push(["Left","("]),1):/^\)/.exec(e)?(this.parser.push(["Right",")"]),1):/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)?(l=/^`?([a-z_][a-z0-9_]{0,}(\:(number|float|string|date|boolean))?)`?/i.exec(e)[1],this.parser.push(["Literal",l]),l.length):/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)?(l=/^'((?:[^\\']+?|\\.|'')*)'(?!')/.exec(e)[0],this.parser.push(["String",l]),l.length):/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)?(l=/^"([^\\"]*(?:\\.[^\\"]*)*)"/.exec(e)[0],this.parser.push(["DoubleString",l]),l.length):/^[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):/^-?[0-9]+(\.[0-9]+)?/.exec(e)?(l=/^-?[0-9]+(\.[0-9]+)?/.exec(e)[0],this.parser.push(["Number",l]),l.length):1},p.prototype.getOperator=function(e,t){return 0===e.indexOf("%")&&"%"===e[e.length-1]?"not like"===t?"notcontains":"contains":0===e.indexOf("%")&&e.indexOf("%")!==e.length-1?"not like"===t?"notstartswith":"startswith":0!==e.indexOf("%")&&e.indexOf("%")===e.length-1?"not like"===t?"notendswith":"endswith":{"=":"equal","!=":"notequal","<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal",in:"in","not in":"notin",between:"between","not between":"notbetween","is empty":"isempty","is null":"isnull","is not null":"isnotnull","is not empty":"isnotempty"}[t]},p.prototype.getTypeFromColumn=function(e){for(var t=this.columns,l=0;l<t.length;l++)if(t[l].field===e.field){e.type=t[l].type;break}return e.type},p.prototype.processParser=function(e,t,l){for(var n,r,o,i,a,s,u,p,d,c,h=[],m=[],f=0,g=e.length;f<g;f++)if("Literal"===e[f][0]){if(o={label:e[f][1],field:e[f][1]},"SubOperators"===e[f+1][0]){for(e[f+1][1].indexOf("null")>-1||e[f+1][1].indexOf("empty")>-1?(o.operator=this.getOperator(" ",e[f+1][1]),o.value=null,o.type=this.getTypeFromColumn(o)):o.operator=this.getOperator(e[f+3][1].replace(/'/g,""),e[f+1][1]),c=e[f+1][1],n=++f+1,r=g,n=f+1;n<r;n++){if("Right"===e[n][0]){f=n;break}if(c.indexOf("null")>-1||c.indexOf("empty")>-1)break;if(c.indexOf("like")>-1&&"String"===e[n][0])o.value=e[n][1].replace(/'/g,"").replace(/%/g,""),o.type="string";else if(c.indexOf("between")>-1){if("Literal"===e[n][0]||"Left"===e[n][0])break;"Number"===e[n][0]?h.push(Number(e[n][1])):"String"===e[n][0]&&m.push(e[n][1].replace(/'/g,""))}else"Number"===e[n][0]?h.push(Number(e[n][1])):"String"===e[n][0]&&m.push(e[n][1].replace(/'/g,""));o.type=this.getTypeFromColumn(o)}c.indexOf("like")<0&&("Number"===e[n-1][0]?(o.value=h,o.type="number"):"String"===e[n-1][0]?(o.value=m,o.type="string"):c.indexOf("between")>-1&&"Conditions"===e[n-1][0]&&(o.value=h,o.type="number"),h=[],m=[],o.type=this.getTypeFromColumn(o))}else"Operators"===e[f+1][0]&&(o.operator=this.getOperator(e[f+2][1],e[f+1][1]),"Number"===e[f+2][0]?(o.type="number",o.value=Number(e[f+2][1])):(o.type="string",o.value=e[f+2][1].replace(/'/g,"")),o.type=this.getTypeFromColumn(o));t.rules.push(o)}else{if("Left"===e[f][0]){if("Left"!==e[0][0]&&"not"===e[f-1][1])continue;for(this.parser=e.splice(f+1,g-(f+1)),i=this.enableNotCondition?{condition:"and",rules:[],not:!1}:{condition:"and",rules:[]},d=0,s=t.rules.length,a=0;a<s;a++)t.rules[a].rules&&d++;return l.push(d),t.rules.push(i),i=this.processParser(this.parser,i,l),t}if("Conditions"===e[f][0])"not"===e[f][1]?t.not=!0:t.condition=e[f][1];else if("Right"===e[f][0]){for(this.parser=e.splice(f+1,g-(f+1)),l.pop(),t=this.rule,p=l.length,u=0;u<p;u++)t=this.findGroupByIdx(l[u],t,0===u);return this.processParser(this.parser,t,l)}}return t},p.prototype.isBlazor=function(){return-1!==Object.keys(window).indexOf("ejsInterop")},c([t.Event()],p.prototype,"created",void 0),c([t.Event()],p.prototype,"beforeChange",void 0),c([t.Event()],p.prototype,"change",void 0),c([t.Event()],p.prototype,"ruleChange",void 0),c([t.Property({ruleDelete:!0,groupInsert:!0,groupDelete:!0})],p.prototype,"showButtons",void 0),c([t.Property(!1)],p.prototype,"summaryView",void 0),c([t.Property(!1)],p.prototype,"allowValidation",void 0),c([t.Property([])],p.prototype,"columns",void 0),c([t.Property("")],p.prototype,"cssClass",void 0),c([t.Property([])],p.prototype,"dataSource",void 0),c([t.Property("Horizontal")],p.prototype,"displayMode",void 0),c([t.Property(!1)],p.prototype,"enablePersistence",void 0),c([t.Property("Default")],p.prototype,"sortDirection",void 0),c([t.Property(5)],p.prototype,"maxGroupCount",void 0),c([t.Property("auto")],p.prototype,"height",void 0),c([t.Property("auto")],p.prototype,"width",void 0),c([t.Property(!1)],p.prototype,"matchCase",void 0),c([t.Property(0)],p.prototype,"immediateModeDelay",void 0),c([t.Property(!1)],p.prototype,"enableNotCondition",void 0),c([t.Complex({condition:"and",rules:[]},m)],p.prototype,"rule",void 0),c([t.NotifyPropertyChanges],p)}(t.Component);return e.Columns=h,e.Rule=m,e.ShowButtons=f,e.QueryBuilder=g,e};window.checkDependencies(["base","buttons","dropdowns","data","inputs","calendars","splitbuttons","popups"],(function(){sf.querybuilder=sf.querybuilder({},sf.base,sf.buttons,sf.dropdowns,sf.data,sf.inputs,sf.calendars,sf.splitbuttons,sf.popups)}))}}]);